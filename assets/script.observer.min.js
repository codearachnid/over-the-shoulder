window.tracking={config:{interval:600},actionInterval:null,actionPoll:function(){var e=new XMLHttpRequest,t=new FormData;t.append("action","observer"),t.append("room_key",document.getElementById("room_key").value),t.append("x",window.tracking.mousePosition.x),t.append("y",window.tracking.mousePosition.y),console.log("polling client cursor",window.tracking.mousePosition),e.open("POST","/api/track.json",!0),e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),e.position&&"x"in e.position&&"y"in e.position?(document.getElementById("remote-cursor").classList.remove("hidden"),document.getElementById("tracking").classList.add("active"),document.getElementById("remote-cursor").style.left=e.position.x+"px",document.getElementById("remote-cursor").style.top=e.position.y+"px"):(console.log("no position to track"),document.getElementById("remote-cursor").classList.add("hidden"),document.getElementById("tracking").classList.remove("active"))}},e.send(t)},mousePosition:{x:null,y:null},mousePositionListener:function(e){window.tracking.status&&(window.tracking.mousePosition={x:e.clientX,y:e.clientY})},statusValue:!1,set status(e){this.statusValue=e,this.statusListener(e)},get status(){return this.statusValue},statusListener:function(e){this.statusListener=e}},window.tracking.statusListener(function(e){console.log("window.tracking "+e),e?(document.getElementById("request_room").classList.add("hidden"),document.getElementById("room").classList.remove("hidden"),window.tracking.actionInterval=setInterval(window.tracking.actionPoll,window.tracking.config.interval),document.getElementById("tracking").addEventListener("mousemove",window.tracking.mousePositionListener)):(document.getElementById("request_room").classList.remove("hidden"),document.getElementById("room").classList.add("hidden"),clearInterval(window.tracking.actionInterval),document.getElementById("tracking").removeEventListener("mousemove",window.tracking.mousePositionListener))}),window.tracking.config.interval=900,document.getElementById("request_room").addEventListener("click",function(){document.getElementById("request_room").classList.add("hidden"),document.getElementById("room").classList.remove("hidden")}),document.getElementById("room_join").addEventListener("click",function(){var e=new XMLHttpRequest,t=new FormData;t.append("action","validate"),t.append("room_key",document.getElementById("room_key").value),e.open("POST","/api/room.json",!0),e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),document.getElementById("room_status").value="tracking",window.tracking.status=!0}},e.send(t)}),document.getElementById("room_terminate").addEventListener("click",function(){window.tracking.status=!1,document.getElementById("remote-cursor").classList.add("hidden"),document.getElementById("tracking").classList.remove("active");var e=new XMLHttpRequest,t=new FormData;t.append("action","destroy"),t.append("room_key",document.getElementById("room_key").value),e.open("POST","/api/room.json",!0),e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);console.log(e),document.getElementById("room_key").value="",document.getElementById("room_status").value="closed",window.tracking.status=!1}},e.send(t)});